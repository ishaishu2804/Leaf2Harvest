{% extends "base.html" %}

{% block title %}Smart Crop Recommendation{% endblock %}

{% block extra_css %}
<style>
    .recommendation-hero {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 60px 0;
        margin-bottom: 40px;
    }
    
    .form-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: transform 0.3s ease;
    }
    
    .form-card:hover {
        transform: translateY(-5px);
    }
    
    .form-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .form-body {
        padding: 40px;
        background: #f8f9fa;
    }
    
    .input-group-custom {
        margin-bottom: 25px;
        position: relative;
    }
    
    .input-group-custom label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
        display: block;
    }
    
    .input-group-custom input {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 15px 20px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: white;
    }
    
    .input-group-custom input:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        outline: none;
    }
    
    .input-icon {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        font-size: 18px;
    }
    
    .help-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 5px;
        font-style: italic;
    }
    
    .range-slider {
        margin-top: 10px;
    }
    
    .range-slider input[type="range"] {
        width: 100%;
        height: 8px;
        border-radius: 5px;
        background: #e9ecef;
        outline: none;
        -webkit-appearance: none;
    }
    
    .range-slider input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #28a745;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    
    .range-slider input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #28a745;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    
    .range-value {
        display: inline-block;
        background: #28a745;
        color: white;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-left: 10px;
    }
    
    .submit-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        padding: 15px 40px;
        border-radius: 25px;
        color: white;
        font-size: 18px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        width: 100%;
        margin-top: 20px;
    }
    
    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        color: white;
    }
    
    .result-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-top: 30px;
        background: linear-gradient(135deg, #e8f5e9 0%, #d4edda 100%);
    }
    
    .result-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .result-body {
        padding: 40px;
    }
    
    .crop-name {
        font-size: 2.5rem;
        font-weight: bold;
        color: #28a745;
        margin-bottom: 20px;
        text-align: center;
    }
    
    .crop-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        display: block;
        text-align: center;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }
    
    .info-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        text-align: center;
        transition: transform 0.3s ease;
    }
    
    .info-card:hover {
        transform: translateY(-3px);
    }
    
    .info-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        color: #28a745;
    }
    
    .info-title {
        font-weight: 600;
        color: #495057;
        margin-bottom: 10px;
    }
    
    .info-text {
        color: #6c757d;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    .tips-section {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-top: 30px;
    }
    
    .tips-title {
        color: #28a745;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }
    
    .tips-title i {
        margin-right: 10px;
        font-size: 1.2rem;
    }
    
    .tip-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 12px;
        padding: 10px 0;
    }
    
    .tip-item i {
        color: #28a745;
        margin-right: 12px;
        margin-top: 2px;
        flex-shrink: 0;
    }
    
    .tip-text {
        color: #495057;
        line-height: 1.5;
    }
    
    .loading-spinner {
        display: none;
        text-align: center;
        margin: 20px 0;
    }
    
    .spinner-border-custom {
        width: 3rem;
        height: 3rem;
        border-width: 0.3em;
        color: #28a745;
    }
    
    .parameter-explanation {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 10px 10px 0;
    }
    
    .parameter-explanation h6 {
        color: #1976d2;
        font-weight: 600;
        margin-bottom: 10px;
    }
    
    .parameter-explanation p {
        color: #424242;
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    @media (max-width: 768px) {
        .form-body {
            padding: 20px;
        }
        
        .crop-name {
            font-size: 2rem;
        }
        
        .crop-icon {
            font-size: 3rem;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="recommendation-hero">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-3">
            <i class="fas fa-seedling me-3"></i>Smart Crop Recommendation
        </h1>
        <p class="lead mb-0">Get AI-powered crop suggestions based on your soil and weather conditions</p>
    </div>
</div>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Parameter Explanation -->
            <div class="parameter-explanation">
                <h6><i class="fas fa-info-circle me-2"></i>How It Works</h6>
                <p>Our AI analyzes your soil nutrients (N-P-K), weather conditions, and pH levels to recommend the best crops for your specific location. Simply enter your soil test results and current weather data to get personalized recommendations.</p>
            </div>
            
            <!-- Recommendation Form -->
            <div class="form-card">
                <div class="form-header">
                    <h3 class="mb-3">
                        <i class="fas fa-clipboard-list me-2"></i>Enter Your Conditions
                    </h3>
                    <p class="mb-0">Provide accurate data for the best recommendations</p>
                </div>
                
                <div class="form-body">
                    <form method="POST" id="recommendationForm">
                        <div class="row">
                            <!-- Soil Nutrients -->
                            <div class="col-md-6">
                                <h5 class="text-success mb-4">
                                    <i class="fas fa-flask me-2"></i>Soil Nutrients (mg/kg)
                                </h5>
                                
                                <div class="input-group-custom">
                                    <label for="N">
                                        <i class="fas fa-atom me-1"></i>Nitrogen (N)
                                    </label>
                                    <input type="number" class="form-control" id="N" name="N" 
                                           min="0" max="300" step="0.1" required
                                           placeholder="Enter nitrogen level">
                                    <div class="input-icon">
                                        <i class="fas fa-leaf"></i>
                                    </div>
                                    <div class="help-text">Essential for leaf growth and green color</div>
                                    <div class="range-slider">
                                        <input type="range" min="0" max="300" value="50" 
                                               oninput="document.getElementById('N').value = this.value">
                                        <span class="range-value" id="N-value">50</span>
                                    </div>
                                </div>
                                
                                <div class="input-group-custom">
                                    <label for="P">
                                        <i class="fas fa-fire me-1"></i>Phosphorus (P)
                                    </label>
                                    <input type="number" class="form-control" id="P" name="P" 
                                           min="0" max="150" step="0.1" required
                                           placeholder="Enter phosphorus level">
                                    <div class="input-icon">
                                        <i class="fas fa-seedling"></i>
                                    </div>
                                    <div class="help-text">Important for root development and flowering</div>
                                    <div class="range-slider">
                                        <input type="range" min="0" max="150" value="30" 
                                               oninput="document.getElementById('P').value = this.value">
                                        <span class="range-value" id="P-value">30</span>
                                    </div>
                                </div>
                                
                                <div class="input-group-custom">
                                    <label for="K">
                                        <i class="fas fa-bolt me-1"></i>Potassium (K)
                                    </label>
                                    <input type="number" class="form-control" id="K" name="K" 
                                           min="0" max="250" step="0.1" required
                                           placeholder="Enter potassium level">
                                    <div class="input-icon">
                                        <i class="fas fa-apple-alt"></i>
                                    </div>
                                    <div class="help-text">Helps with fruit quality and disease resistance</div>
                                    <div class="range-slider">
                                        <input type="range" min="0" max="250" value="40" 
                                               oninput="document.getElementById('K').value = this.value">
                                        <span class="range-value" id="K-value">40</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Environmental Conditions -->
                            <div class="col-md-6">
                                <h5 class="text-info mb-4">
                                    <i class="fas fa-cloud-sun me-2"></i>Environmental Conditions
                                </h5>
                                
                                <div class="input-group-custom">
                                    <label for="temperature">
                                        <i class="fas fa-thermometer-half me-1"></i>Temperature (Â°C)
                                    </label>
                                    <input type="number" class="form-control" id="temperature" name="temperature" 
                                           min="-10" max="50" step="0.1" required
                                           placeholder="Enter temperature">
                                    <div class="input-icon">
                                        <i class="fas fa-sun"></i>
                                    </div>
                                    <div class="help-text">Average temperature in your area</div>
                                    <div class="range-slider">
                                        <input type="range" min="-10" max="50" value="25" 
                                               oninput="document.getElementById('temperature').value = this.value">
                                        <span class="range-value" id="temperature-value">25</span>
                                    </div>
                                </div>
                                
                                <div class="input-group-custom">
                                    <label for="humidity">
                                        <i class="fas fa-tint me-1"></i>Humidity (%)
                                    </label>
                                    <input type="number" class="form-control" id="humidity" name="humidity" 
                                           min="0" max="100" step="0.1" required
                                           placeholder="Enter humidity">
                                    <div class="input-icon">
                                        <i class="fas fa-cloud-rain"></i>
                                    </div>
                                    <div class="help-text">Relative humidity in your area</div>
                                    <div class="range-slider">
                                        <input type="range" min="0" max="100" value="60" 
                                               oninput="document.getElementById('humidity').value = this.value">
                                        <span class="range-value" id="humidity-value">60</span>
                                    </div>
                                </div>
                                
                                <div class="input-group-custom">
                                    <label for="ph">
                                        <i class="fas fa-vial me-1"></i>Soil pH
                                    </label>
                                    <input type="number" class="form-control" id="ph" name="ph" 
                                           min="0" max="14" step="0.1" required
                                           placeholder="Enter pH level">
                                    <div class="input-icon">
                                        <i class="fas fa-balance-scale"></i>
                                    </div>
                                    <div class="help-text">Soil acidity/alkalinity (6.0-7.5 is ideal)</div>
                                    <div class="range-slider">
                                        <input type="range" min="0" max="14" value="6.5" 
                                               oninput="document.getElementById('ph').value = this.value">
                                        <span class="range-value" id="ph-value">6.5</span>
                                    </div>
                                </div>
                                
                                <div class="input-group-custom">
                                    <label for="rainfall">
                                        <i class="fas fa-cloud-rain me-1"></i>Rainfall (mm)
                                    </label>
                                    <input type="number" class="form-control" id="rainfall" name="rainfall" 
                                           min="0" max="3000" step="1" required
                                           placeholder="Enter rainfall">
                                    <div class="input-icon">
                                        <i class="fas fa-umbrella"></i>
                                    </div>
                                    <div class="help-text">Annual rainfall in your area</div>
                                    <div class="range-slider">
                                        <input type="range" min="0" max="3000" value="1000" 
                                               oninput="document.getElementById('rainfall').value = this.value">
                                        <span class="range-value" id="rainfall-value">1000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-magic me-2"></i>Get Crop Recommendation
                        </button>
                        
                        <!-- Loading Spinner -->
                        <div class="loading-spinner" id="loadingSpinner">
                            <div class="spinner-border spinner-border-custom" role="status">
                                <span class="visually-hidden">Analyzing...</span>
                            </div>
                            <p class="mt-3 text-muted">Analyzing your conditions...</p>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Results Section -->
            {% if crop %}
            <div class="result-card">
                <div class="result-header">
                    <h3 class="mb-3">
                        <i class="fas fa-check-circle me-2"></i>Recommended Crop
                    </h3>
                    <p class="mb-0">Based on your soil and weather conditions</p>
                </div>
                
                <div class="result-body">
                    <div class="crop-icon">{{ crop_info.icon if crop_info else 'ðŸŒ¾' }}</div>
                    <div class="crop-name">{{ crop }}</div>
                    
                    <!-- Crop Information Grid -->
                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="info-title">Planting Season</div>
                            <div class="info-text">{{ crop_info.season if crop_info else 'Varies by crop' }}</div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="info-title">Growth Period</div>
                            <div class="info-text">{{ crop_info.duration if crop_info else 'Varies by crop' }}</div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="info-title">Water Needs</div>
                            <div class="info-text">{{ crop_info.water_needs if crop_info else 'Moderate' }}</div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-thermometer-half"></i>
                            </div>
                            <div class="info-title">Temperature Range</div>
                            <div class="info-text">{{ crop_info.temperature_range if crop_info else 'Varies by crop' }}</div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-mountain"></i>
                            </div>
                            <div class="info-title">Soil Type</div>
                            <div class="info-text">{{ crop_info.soil_type if crop_info else 'Well-drained soil' }}</div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="info-title">Market Value</div>
                            <div class="info-text">{{ crop_info.market_value if crop_info else 'Good demand' }}</div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="info-title">Disease Resistance</div>
                            <div class="info-text">{{ crop_info.disease_resistance if crop_info else 'Moderate' }}</div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="info-title">Soil Health</div>
                            <div class="info-text">{{ soil_analysis.overall_health if soil_analysis else 'Good' }}</div>
                        </div>
                    </div>
                    
                    <!-- Soil Analysis -->
                    {% if soil_analysis %}
                    <div class="tips-section">
                        <h5 class="tips-title">
                            <i class="fas fa-flask"></i>Soil Analysis & Recommendations
                        </h5>
                        
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h6 class="text-success">Nitrogen</h6>
                                    <span class="badge {% if soil_analysis.nitrogen_status == 'Optimal' %}bg-success{% elif soil_analysis.nitrogen_status == 'Low' %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ soil_analysis.nitrogen_status }}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h6 class="text-info">Phosphorus</h6>
                                    <span class="badge {% if soil_analysis.phosphorus_status == 'Optimal' %}bg-success{% elif soil_analysis.phosphorus_status == 'Low' %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ soil_analysis.phosphorus_status }}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h6 class="text-warning">Potassium</h6>
                                    <span class="badge {% if soil_analysis.potassium_status == 'Optimal' %}bg-success{% elif soil_analysis.potassium_status == 'Low' %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ soil_analysis.potassium_status }}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h6 class="text-primary">pH Level</h6>
                                    <span class="badge {% if soil_analysis.ph_status == 'Optimal' %}bg-success{% elif soil_analysis.ph_status == 'Acidic' %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ soil_analysis.ph_status }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        {% if soil_analysis.recommendations %}
                        <h6 class="text-primary mb-3">Soil Improvement Recommendations:</h6>
                        {% for recommendation in soil_analysis.recommendations %}
                        <div class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <div class="tip-text">{{ recommendation }}</div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Growing Tips -->
                    {% if crop_info and crop_info.tips %}
                    <div class="tips-section">
                        <h5 class="tips-title">
                            <i class="fas fa-lightbulb"></i>Growing Tips for {{ crop }}
                        </h5>
                        
                        {% for tip in crop_info.tips %}
                        <div class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <div class="tip-text">{{ tip }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Update range values when inputs change
document.addEventListener('DOMContentLoaded', function() {
    const inputs = ['N', 'P', 'K', 'temperature', 'humidity', 'ph', 'rainfall'];
    
    inputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        const range = input.nextElementSibling.nextElementSibling.querySelector('input[type="range"]');
        const valueSpan = document.getElementById(inputId + '-value');
        
        // Update range when input changes
        input.addEventListener('input', function() {
            range.value = this.value;
            valueSpan.textContent = this.value;
        });
        
        // Update input when range changes
        range.addEventListener('input', function() {
            input.value = this.value;
            valueSpan.textContent = this.value;
        });
        
        // Initialize values
        valueSpan.textContent = input.value;
    });
    
    // Show loading spinner on form submit
    document.getElementById('recommendationForm').addEventListener('submit', function() {
        document.getElementById('loadingSpinner').style.display = 'block';
    });
});
</script>
{% endblock %}